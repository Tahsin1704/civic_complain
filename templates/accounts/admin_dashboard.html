{% extends "accounts/base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">

  <!-- Dashboard heading -->
  <h2 class="mb-4">Admin Dashboard</h2>

  <!-- Search -->
  <form method="get" action="{% url 'admin_task_search' %}" class="d-flex mb-4">
      <input type="text" name="q" class="form-control me-2" placeholder="Enter Task Code..." required>
      <button type="submit" class="btn btn-primary">Search</button>
  </form>

  <!-- Stats cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-white bg-primary mb-3">
        <div class="card-body">
          <h5 class="card-title">Total Complaints</h5>
          <p class="card-text">{{ total_complaints }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-warning mb-3">
        <div class="card-body">
          <h5 class="card-title">Pending Complaints</h5>
          <p class="card-text">{{ pending_complaints }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card text-white bg-success mb-3">
        <div class="card-body">
          <h5 class="card-title">Resolved Complaints</h5>
          <p class="card-text">{{ resolved_complaints }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-info mb-3">
        <div class="card-body">
          <h5 class="card-title">Active Workers</h5>
          <p class="card-text">{{ active_workers }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Complaints -->
  <h3 class="mt-4">Recent Complaints</h3>
  <table class="table table-bordered table-striped text-start">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Task Code</th>
        <th>Title</th>
        <th>Category</th>
        <th>Location</th>
        <th>Priority</th>

        <th>Status</th>
        <th>Assigned To</th>
        <th>Photo</th>
        <th>Description</th>
        <th>Instructions</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for c in recent_tasks %}
        <tr>
          <td>{{ c.id }}</td>
          <td>{{ c.task_code }}</td>
       <td>
  {{ c.title }}

</td>

          <td>{{ c.category }}</td>
          <td>{{ c.location }}</td>
          <td>{{ c.priority }}</td>



          <td>{{ c.status }}</td>
          <td>
            {% if c.assigned_to %}
              {% if c.assigned_to.first_name or c.assigned_to.last_name %}
                {{ c.assigned_to.first_name }} {{ c.assigned_to.last_name }}
              {% else %}
                {{ c.assigned_to.email }}
              {% endif %}
            {% else %}
              <em>Not assigned</em>
            {% endif %}
          </td>
          <td>
            {% if c.task_photo %}
              <img src="{{ c.task_photo.url }}" alt="Task Photo" style="width:80px; height:auto;">
            {% else %}
              <em>No photo</em>
            {% endif %}
          </td>
          <td>{{ c.description|truncatechars:50 }}</td>
          <td>{{ c.instructions|truncatechars:50 }}</td>
           <td>
          {% if not c.assigned_to %}
            <a href="{% url 'assign_task' c.id %}" class="btn btn-sm btn-success">Assign</a>
          {% endif %}
          <a href="{% url 'task_preview' c.id %}" class="btn btn-sm btn-info">Preview</a>
          <form method="post" action="{% url 'task_delete' c.id %}" style="display:inline;">
            {% csrf_token %}

          </form>
        </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="12">No complaints yet.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
