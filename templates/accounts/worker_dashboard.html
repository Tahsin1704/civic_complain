{% extends "accounts/base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>Welcome back, {{ request.user.first_name }}!</h2>
<!-- ðŸ” Search Bar -->
<form method="get" action="{% url 'worker_search_task' %}" class="d-flex mb-4" style="max-width: 400px;">
  <input type="text" name="query" class="form-control me-2" placeholder="Enter Task ID..." required>
  <button class="btn btn-outline-primary" type="submit">Search</button>
</form>


    <!-- Summary Buttons -->
    <div class="summary-container">
      <button id="btn-new" class="summary-box active" onclick="showSection('new')">
        <p class="summary-text">New Tasks</p>
        <h4 class="summary-number">{{ new_tasks|length }}</h4>
      </button>
      <button id="btn-progress" class="summary-box" onclick="showSection('progress')">
        <p class="summary-text">In Progress</p>
        <h4 class="summary-number">{{ in_progress_tasks|length }}</h4>
      </button>
      <button id="btn-completed" class="summary-box" onclick="showSection('completed')">
        <p class="summary-text">Completed</p>
        <h4 class="summary-number">{{ completed_tasks|length }}</h4>
      </button>
    </div>

    <!-- âœ… New Tasks Section -->
    <div id="section-new" class="task-section">
        <h4>New Assignments</h4>
        {% for task in new_tasks %}
            <div class="card mb-2">
                <div class="card-body">
                    <p><strong>Task Code:</strong> {{ task.task_code }}</p>

                    <h5><strong>Title:</strong> {{ task.title }}</h5>
                    <p><strong>Category:</strong> {{ task.category }}</p>
                    <p><strong>Location:</strong> {{ task.location }}</p>
                    <p><strong>Priority:</strong> {{ task.priority|title }}</p>
 {% if task.task_photo %}
      <p><strong>Photo:</strong></p>
      <img src="{{ task.task_photo.url }}" alt="Task Photo" style="width:150px; height:auto; margin-bottom:10px;">
    {% else %}
      <p><em>No photo submitted by citizen.</em></p>
    {% endif %}

  <div class="mt-3">
            <a href="{% url 'view_task' task.id %}" class="btn btn-primary btn-sm">View Task</a>
        </div>
                </div>
            </div>
        {% empty %}
            <p>No new assignments.</p>
        {% endfor %}
    </div>

<!-- âœ… In Progress Section -->
<div id="section-progress" class="task-section" style="display:none;">
    <h4>In Progress</h4>
    {% for task in in_progress_tasks %}
        <div class="card mb-2">
            <div class="card-body">
                <p><strong>Task Code:</strong> {{ task.task_code }}</p>
                <h5><strong>Title:</strong> {{ task.title }}</h5>
                <p><strong>Category:</strong> {{ task.category }}</p>
                <p><strong>Location:</strong> {{ task.location }}</p>
                <p><strong>Priority:</strong> {{ task.priority|title }}</p>

                <!-- Estimated Time -->
                <p><strong>Estimated Time:</strong> {{ task.estimated_time|default:"-" }}</p>

                <!-- âœ… Citizen Submitted Photo -->
                {% if task.task_photo %}
                    <p><strong>Citizen Submitted:</strong></p>
                    <img src="{{ task.task_photo.url }}" alt="Citizen submitted {{ task.title }}"
                         style="max-width:200px; border-radius:8px; margin-top:10px;">
                {% else %}
                    <p><em>No citizen photo submitted.</em></p>
                {% endif %}

                <!-- âœ… Show latest progress -->
                {% if task.progress %}
                    <p><strong>Latest Progress:</strong> {{ task.progress }}</p>
                {% else %}
                    <p><em>No progress update yet.</em></p>
                {% endif %}

                <div class="mt-3">
                    <a href="{% url 'update_task_status' task.id %}" class="btn btn-warning btn-sm mt-2">
                        Update Status
                    </a>
                </div>
            </div>
        </div>
    {% empty %}
        <p>No tasks in progress.</p>
    {% endfor %}
</div>


<!-- âœ… Completed Section -->
<div id="section-completed" class="task-section" style="display:none;">
    <h4>Completed</h4>
    {% for task in completed_tasks %}
        <div class="card mb-2">
            <div class="card-body">
                  <p><strong>Task Code:</strong> {{ task.task_code }}</p>
                <h5><strong>Title:</strong> {{ task.title }}</h5>
                <p><strong>Category:</strong> {{ task.category }}</p>
                <p><strong>Location:</strong> {{ task.location }}</p>
                <p><strong>Priority:</strong> {{ task.priority|title }}</p>
                <p><strong>Completed at:</strong> {{ task.completed_at }}</p>
                    <p><strong>Work Description:</strong> {{ task.work_description }}</p>
    <p><strong>Materials Used:</strong> {{ task.materials_used }}</p>
    <p><strong>Additional Notes:</strong> {{ task.additional_notes }}</p>

                <!-- Citizen's Submitted Photo -->
                {% if task.task_photo %}
                    <p><strong>Citizen Submitted:</strong></p>
                    <img src="{{ task.task_photo.url }}" alt="Submitted {{ task.title }}"
                         style="max-width:200px; border-radius:8px; margin-top:10px;">
                {% else %}
                    <p><em>No submitted photo.</em></p>
                {% endif %}


                <!-- Worker's After Photo -->
                {% if task.after_photo %}
                    <p><strong>After Work:</strong></p>
                    <img src="{{ task.after_photo.url }}" alt="After {{ task.title }}"
                         style="max-width:200px; border-radius:8px; margin-top:10px;">
                {% else %}
                    <p><em>No after photo uploaded.</em></p>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <p>No completed tasks.</p>
    {% endfor %}
</div>


</div>

<style>
.summary-container {
  display: flex;
  justify-content: space-between;
  gap: 20px;
  margin-bottom: 20px;
}
.summary-box {
  flex: 1;
  text-align: center;
  background: #ffffff;
  color: #000000;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  cursor: pointer;
  border: none;
  transition: background 0.3s, color 0.3s;
}
.summary-box:hover {
  background: #f0f0f0;
}
.summary-box.active {
  background: #007bff;
  color: white;
  font-weight: bold;
}
.summary-text {
  font-weight: bold;
  margin: 0;
}
.summary-number {
  font-size: 24px;
  margin: 5px 0 0 0;
}
.task-section {
  margin-top: 20px;
}
</style>

<script>
function showSection(section) {
    // à¦¸à¦¬ section hide à¦•à¦°à¦¬à§‹
    document.querySelectorAll('.task-section').forEach(div => {
        div.style.display = "none";
    });
    // à¦¯à§‡à¦Ÿà¦¾ à¦•à§à¦²à¦¿à¦• à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡ à¦¸à§‡à¦Ÿà¦¾ à¦¦à§‡à¦–à¦¾à¦¬à§‹
    document.getElementById("section-" + section).style.display = "block";

    // active button à¦Ÿà¦—à¦² à¦•à¦°à¦¬à§‹
    document.querySelectorAll('.summary-box').forEach(btn => {
        btn.classList.remove("active");
    });
    document.getElementById("btn-" + section).classList.add("active");
}
</script>

{% endblock %}
