{% extends 'accounts/base.html' %}
{% block content %}

<h2>Welcome back, {{ citizen.first_name }}!</h2>

<!-- Submit New Complaint Button -->
<a href="{% url 'submit_task' %}" class="btn btn-primary mb-3">âž• Submit New Complaint</a>



<!-- Status Summary -->
<div class="d-flex gap-3 mb-4">
  <div class="p-3 rounded bg-light border"><strong>New:</strong> {{ new_count }}</div>
  <div class="p-3 rounded bg-warning-subtle border"><strong>In Progress:</strong> {{ in_progress_count }}</div>
  <div class="p-3 rounded bg-success-subtle border"><strong>Completed:</strong> {{ completed_count }}</div>
</div>

<!-- My Complaints Table -->
<h3>My Complaints</h3>
<table class="table table-striped table-bordered">
  <thead class="table-light">
    <tr>
       <th>Task Code</th>
      <th>Title</th>
      <th>Category</th>
       <th>Description</th>
      <th>Location</th>
      <th>Photo</th>
      <th>Status</th>
      <th>Assigned To</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for task in my_tasks %}
      <tr>
            <tr>
      <td>{{ task.task_code }}</td>
        <td>{{ task.title }}</td>
        <td>{{ task.category }}</td>
         <td>{{ task.description }}</td>
        <td>{{ task.location }}</td>
        <td>
          {% if task.task_photo %}
            <img src="{{ task.task_photo.url }}" alt="Task Photo" width="100">
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if task.status == 'new' %}
            <span class="badge bg-secondary">New</span>
          {% elif task.status == 'in_progress' %}
            <span class="badge bg-warning text-dark">In Progress</span>
          {% elif task.status == 'completed' %}
            <span class="badge bg-success">Completed</span>
          {% endif %}
        </td>
        <td>{% if task.assigned_to %}{{ task.assigned_to.email }}{% else %}-{% endif %}</td>
        <td><a href="{% url 'citizen_task_detail' task.id %}" class="btn btn-info btn-sm">View</a></td>
      </tr>
    {% empty %}
      <tr><td colspan="7" class="text-center">No complaints found.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
